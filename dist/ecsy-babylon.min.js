!function(e,t){"use strict";class i{constructor(){this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0},this.scale={x:1,y:1,z:1}}}class s{constructor(){this.options={}}}var n,r,o,a,c,d,h,u,l;!function(e){e.Box="Box",e.Plane="Plane",e.Sphere="Sphere",e.Ground="Ground"}(n||(n={}));class m{}!function(e){e.Point="Point",e.Directional="Directional",e.Spot="Spot",e.Hemispheric="Hemispheric"}(r||(r={}));class p{constructor(){this.direction={x:0,y:0,z:0}}}class g{}!function(e){e.Point="Point",e.Box="Box",e.Sphere="Sphere",e.DirectedSphere="DirectedSphere",e.Hemisphere="Hemisphere",e.Cylinder="Cylinder",e.DirectedCylinder="DirectedCylinder",e.Cone="Cone"}(o||(o={}));class f{constructor(){this.emitter={x:0,y:0,z:0},this.direction1={x:0,y:0,z:0},this.direction2={x:0,y:10,z:10},this.minEmitBox={x:0,y:0,z:0},this.maxEmitBox={x:0,y:0,z:0}}}!function(e){e.babylon="Babylon"}(a||(a={}));class y{}function b(t){return e.Angle.FromDegrees(t).radians()}function x(e){return e.world}function S(e){e.object&&e.object.dispose()}function _(e,t){return x(e).getSystems().find(e=>void 0!==e.activeScene).getScene(t)}function C(t){return new e.Vector3(t.x,t.y,t.z)}function E(t){return e.Color3.FromHexString(t)}function j(t,i,s){Object.keys(i).forEach(n=>{let r=i[n],o=new e.Texture(r.url,_(s,t.sceneName));Object.keys(r).filter(e=>"url"===e).forEach(e=>{o[e]=r[e]}),t.object[`${n}Texture`]&&S(t.object[`${n}Texture`]),t.object[`${n}Texture`]=o})}function v(e,t){if(t.object){let i=t.object;i.position&&(i.position=C(e.position)),i.rotation&&i.rotation.set(b(e.rotation.x),b(e.rotation.y),b(e.rotation.z)),i.scaling&&(i.scaling=C(e.scale))}}class M extends t.System{constructor(){super(...arguments),this.scenes=new Map,this._lastTime=0,this._isRendering=!1}get activeScene(){return this._activeScene}init(){this._render=this._render.bind(this)}execute(){this.queries.camera.added.forEach(t=>{let i=t.getComponent(s),n=this.getScene(i.sceneName);i.object=new e.VRExperienceHelper(n,i.options),n===this._activeScene&&(this._isRendering=!0)}),this.queries.camera.removed.forEach(e=>{let t=e.getComponent(s);S(t),this.getScene(t.sceneName)===this._activeScene&&(this._isRendering=!1)})}start(t,i,s,n){return this.engine=new e.Engine(t,i,s,n),this._lastTime=performance.now(),this.engine.runRenderLoop(this._render),this}getScene(e){return e?this.scenes.get(e):this._activeScene}addScene(t,i){let s=new e.Scene(this.engine,i);return this.scenes.set(t,s),1===this.engine.scenes.length&&(this._activeScene=s),this}_render(){let e=performance.now();x(this).execute(e-this._lastTime,e),this._isRendering&&x(this).enabled&&this._activeScene.render(),this._lastTime=e}}M.queries={camera:{components:[s],listen:{added:!0,removed:!0}}};class q extends t.System{init(){window.addEventListener("load",()=>{this.queries.object.results.forEach(e=>{this._updateTransform(e.getComponent(i),e.getComponents())})})}execute(){this.queries.object.changed.forEach(e=>{this._updateTransform(e.getComponent(i),e.getComponents())})}_updateTransform(e,t){Object.keys(t).filter(e=>void 0!==t[e].object).forEach(i=>v(e,t[i]))}}q.queries={object:{components:[i],listen:{changed:[i]}}};class w extends t.System{execute(){this.queries.mesh.added.forEach(t=>{let i,s=t.getComponent(m);i=s.type?s.type:n.Box,s.object=e.MeshBuilder[`Create${i}`].call(null,i,s.options?s.options:{},_(this,s.sceneName))}),this.queries.mesh.removed.forEach(e=>{S(e.getComponent(m))})}}w.queries={mesh:{components:[m],listen:{added:!0,removed:!0}}},function(e){e.specular="specular"}(c||(c={})),function(e){e.direction="direction"}(d||(d={}));class k extends t.System{execute(){this.queries.light.added.forEach(t=>{let i=t.getComponent(p),s=C(i.direction),n=_(this,i.sceneName);switch(i.type){case r.Point:i.object=new e.PointLight(i.type,e.Vector3.Zero(),n);break;case r.Directional:i.object=new e.DirectionalLight(i.type,s,n);break;case r.Spot:i.object=new e.SpotLight(i.type,e.Vector3.Zero(),s,b(i.angle),i.exponent,n);break;default:i.object=new e.HemisphericLight(r.Hemispheric,s,n)}this._updateLight(i)}),this.queries.light.changed.forEach(e=>{this._updateLight(e.getComponent(p))}),this.queries.light.removed.forEach(e=>{S(e.getComponent(p))})}_updateLight(e){let t=e.object;Object.keys(e).forEach(i=>{c[i]?t[i]=E(e[i]):d[i]?t[i]=C(e[i]):t[i]=e[i]})}}k.queries={light:{components:[p],listen:{added:!0,removed:!0,changed:!0}}},function(e){e.diffuse="diffuse",e.specular="specular",e.emissive="emissive",e.ambient="ambient"}(h||(h={}));class B extends t.System{execute(){this.queries.meshMaterial.added.forEach(t=>{let i=t.getComponent(g);i.object=new e.StandardMaterial(i.diffuse?i.diffuse:"#ffffff",_(this,i.sceneName)),this._updateMaterial(i),t.getComponent(m).object.material=i.object}),this.queries.meshMaterial.changed.forEach(e=>{this._updateMaterial(e.getComponent(g))}),this.queries.meshMaterial.removed.forEach(e=>{S(e.getComponent(g)),e.getComponent(m).object.material=null})}_updateMaterial(e){let t=e.object;Object.keys(e).forEach(i=>{h[i]?t[`${i}Color`]=E(e[i]):"texture"===i?e.texture&&j(e,e.texture,this):t[i]=e[i]})}}B.queries={meshMaterial:{components:[m,g],listen:{added:!0,removed:!0,changed:[g]}}},function(e){e.textureMask="textureMask"}(u||(u={})),function(e){e.emitter="emitter",e.direction1="direction1",e.direction2="direction2"}(l||(l={}));class P extends t.System{execute(){this.queries.particle.added.forEach(t=>{let i=t.getComponent(f);i.object=new e.ParticleSystem(i.type?i.type:o.Point,i.capacity?i.capacity:100,_(this,i.sceneName));let s=i.object;switch(i.type){case o.Point:s.createPointEmitter(C(i.direction1),C(i.direction2));break;case o.Box:s.createBoxEmitter(C(i.direction1),C(i.direction2),C(i.minEmitBox),C(i.maxEmitBox));break;case o.Sphere:s.createSphereEmitter(i.radius,i.radiusRange);break;case o.DirectedSphere:s.createDirectedSphereEmitter(i.radius,C(i.direction1),C(i.direction2));break;case o.Hemisphere:s.createHemisphericEmitter(i.radius,i.radiusRange);break;case o.Cylinder:s.createCylinderEmitter(i.radius,i.height,i.radiusRange,Math.random());break;case o.DirectedCylinder:s.createDirectedCylinderEmitter(i.radius,i.height,i.radiusRange,C(i.direction1),C(i.direction2));break;case o.Cone:s.createConeEmitter(i.radius,i.angle)}this._updateParticle(i),s.start()}),this.queries.particle.changed.forEach(e=>{this._updateParticle(e.getComponent(f))}),this.queries.particle.removed.forEach(e=>{let t=e.getComponent(f);t.object.stop(),S(t)})}_updateParticle(t){let i=t.object;Object.keys(t).forEach(s=>{l[s]?i[s]=C(t[s]):u[s]?i[s]=function(t){return e.Color4.FromHexString(t)}(t[s]):"texture"===s?t.texture&&j(t,t.texture,this):i[s]=t[s]})}}P.queries={particle:{components:[f],listen:{added:!0,changed:!0,removed:!0}}};class T extends t.System{execute(){this.queries.asset.added.forEach(t=>{let s=t.getComponent(y);this._assetManager||(this._assetManager=new e.AssetsManager(_(this,s.sceneName))),this._assetManager.useDefaultLoadingScreen=!1,s.type,this._loadBabylon(t.getComponent(i),s),this._assetManager.load()}),this.queries.asset.removed.forEach(e=>{S(e.getComponent(y))})}_loadBabylon(e,t){let i=t.url.lastIndexOf("/")+1;this._assetManager.addMeshTask(a.babylon,"",t.url.substring(0,i),t.url.substring(i,t.url.length)).onSuccess=i=>{t.object=i.loadedMeshes[0],v(e,t)}}}T.queries={asset:{components:[i,y],listen:{added:!0,removed:!0}}};var D=Object.freeze({__proto__:null,GameSystem:M,TransformSystem:q,MeshSystem:w,LightSystem:k,MaterialSystem:B,ParticleSystem:P,AssetSystem:T,Transform:i,Camera:s,get MeshTypes(){return n},Mesh:m,get LightTypes(){return r},Light:p,Material:g,get ParticleTypes(){return o},Particle:f,get AssetTypes(){return a},Asset:y});window.EB=D}(BABYLON,ECSY);
